#!/usr/bin/env python3
"""
Debug test for BOF payload generation
"""

import os
import sys
import traceback

# Add Intellicrack to Python path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'intellicrack'))

def test_bof_debug():
    """Debug BOF payload generation."""
    try:
        from intellicrack.core.analysis.radare2_vulnerability_engine import R2VulnerabilityEngine
        
        print("Importing vulnerability engine...")
        
        # Create test binary path
        binary_path = "C:\\Windows\\System32\\notepad.exe"
        
        print(f"Initializing with binary: {binary_path}")
        engine = R2VulnerabilityEngine(binary_path)
        
        print("Engine initialized successfully")
        
        # Create minimal test data
        test_vuln = {"function": {"name": "test"}, "offset": 0}
        
        print("Calling _generate_bof_payload...")
        result = engine._generate_bof_payload(test_vuln)
        
        print(f"Result type: {type(result)}")
        print(f"Result keys: {result.keys() if isinstance(result, dict) else 'Not a dict'}")
        
        if isinstance(result, dict) and "shellcode" in result:
            shellcode = result["shellcode"]
            print(f"Shellcode type: {type(shellcode)}")
            print(f"Shellcode length: {len(shellcode) if hasattr(shellcode, '__len__') else 'No len'}")
            if isinstance(shellcode, bytes):
                print(f"Shellcode hex: {shellcode.hex()}")
                return True
        
        return False
        
    except Exception as e:
        print(f"Exception: {e}")
        traceback.print_exc()
        return False

if __name__ == "__main__":
    test_bof_debug()