"""Bypass Engine Module - Central engine for exploit mitigation bypasses.

Copyright (C) 2025 Zachary Flint

This file is part of Intellicrack.

Intellicrack is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Intellicrack is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Intellicrack.  If not, see https://www.gnu.org/licenses/.
"""

from typing import Any

from ...utils.logger import get_logger
from ..shared.bypass_config import BypassConfig


class BypassEngine:
    """Engine for exploit mitigation bypass techniques."""

    def __init__(self) -> None:
        """Initialize the bypass engine with detection and exploitation capabilities."""
        self.logger = get_logger(__name__)

    def analyze_bypass_capabilities(self, target_info: dict[str, Any]) -> dict[str, Any]:
        """Analyze available bypass capabilities for a target.

        Args:
            target_info: Dictionary containing target protection information with keys like
                'aslr_enabled', 'dep_enabled', 'cfi_enabled', 'cfg_enabled', 'cet_enabled'.

        Returns:
            Dictionary containing 'bypasses_available' list, 'target_info' dict, and 'bypass_count' int.

        """
        return BypassConfig.analyze_bypass_capabilities(target_info)

    def get_available_bypasses(self) -> list[str]:
        """Get list of all available bypass types.

        Returns:
            List of available bypass type identifiers.

        """
        return BypassConfig.get_available_bypasses()

    def get_bypass_info(self, bypass_type: str) -> dict[str, Any]:
        """Get detailed information about a specific bypass type.

        Args:
            bypass_type: The bypass type identifier (e.g., 'aslr_bypass', 'dep_bypass').

        Returns:
            Dictionary containing bypass details including description, target_protection,
            difficulty, and reliability rating.

        """
        return BypassConfig.get_bypass_info(bypass_type)

    def get_recommended_bypasses(self, target_info: dict[str, Any], min_reliability: int = 6) -> list[str]:
        """Get recommended bypasses based on target and reliability threshold.

        Args:
            target_info: Dictionary containing target protection information with keys like
                'aslr_enabled', 'dep_enabled', 'cfi_enabled', 'cfg_enabled', 'cet_enabled'.
            min_reliability: Minimum reliability rating (0-10) for recommended bypasses. Defaults to 6.

        Returns:
            List of recommended bypass type identifiers that meet the reliability threshold.

        """
        return BypassConfig.get_recommended_bypasses(target_info, min_reliability)


__all__ = ["BypassEngine"]
