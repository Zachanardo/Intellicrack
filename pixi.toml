[workspace]
name = "Intellicrack"
version = "0.1.0"
authors = ["Zachary Flint <zach.flint2@gmail.com>"]
description = "Intellicrack: Advanced Binary Analysis and Security Research Framework with AI-driven capabilities"
channels = ["conda-forge"]
platforms = ["win-64"]
preview = ["pixi-build"]

[environments]

[dependencies]
python = "3.12.*"
rust = ">=1.70"
m2w64-toolchain = ">=5.3.0,<6"
m2w64-binutils = ">=2.25.1,<3"
nodejs = "*"
git = "*"

[pypi-dependencies]
intellicrack = { path = ".", editable = true }
torch = "*"
torchvision = "*"
torchaudio = "*"

[pypi-options]
extra-index-urls = ["https://download.pytorch.org/whl/xpu"]
index-strategy = "unsafe-best-match"

[tasks]
# Complete installation: installs dependencies + post-install setup
setup = { depends-on = ["install-linters", "build-rust-launcher"] }

# Rust launcher build
build-rust-launcher = '''
cargo build --release --manifest-path intellicrack-launcher/Cargo.toml
$WshShell = New-Object -ComObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut("$PWD\Intellicrack.lnk")
$Shortcut.TargetPath = "$PWD\intellicrack-launcher\target\release\Intellicrack.exe"
$Shortcut.IconLocation = "$PWD\intellicrack\assets\icon.ico"
$Shortcut.WorkingDirectory = "$PWD"
$Shortcut.Save()
Write-Output "Shortcut created: Intellicrack.lnk"
'''

# Linter installation (Node.js based)
install-linters = { depends-on = ["install-eslint", "install-markdownlint"] }
install-eslint = "npm install -g eslint@9.18.0 eslint-config-standard@17.1.0"
install-markdownlint = "npm install -g markdownlint-cli@0.43.0"

# Documentation generation tasks
docs-apidoc = "sphinx-apidoc -f -o docs/source intellicrack"
docs-build = "sphinx-build -b html docs/source docs/_build/html"
docs-clean = "rm -rf docs/_build"
docs-generate = { depends-on = ["docs-apidoc", "docs-build"] }
docs-rebuild = { depends-on = ["docs-clean", "docs-generate"] }
