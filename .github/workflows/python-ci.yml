name: Python CI

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

permissions:
  contents: read

jobs:
  build:
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.10", "3.11", "3.12", "3.13"]

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pytest black isort
        # Install dependencies from requirements.txt if it exists
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        # Install development dependencies if requirements-dev.txt exists
        if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi
        # Install the package itself in editable mode to make its modules available for tests
        pip install -e .

    - name: Lint and format with ruff
      run: |
        # Ruff replaces flake8, black, isort, and many other tools
        pip install ruff==0.5.0
        # Check for linting errors and code quality issues
        ruff check intellicrack/ tests/ --output-format=github
        # Format check (replaces black and isort)
        ruff format --check intellicrack/ tests/

    - name: Test with pytest
      run: |
        pytest
